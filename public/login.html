<!DOCTYPE html>
<html>
<head>
    <title>Runway Login</title>
    <script src="https://accounts.google.com/gsi/client"></script>
    <style>body{background:#0f172a;color:white;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;}</style>
</head>
<body>
    <h2>Runway Automation Pro</h2>
    <p>Please sign in to continue.</p>
    
    <div id="buttonDiv"></div>
    
    <div id="status" style="margin-top:20px;color:#38bdf8;"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const EXT_ID = params.get('ext_id');
        const STATUS = document.getElementById('status');

        // 2. INITIALIZE GOOGLE AUTH
        // ⚠️ REPLACE THIS CLIENT_ID WITH YOUR "WEB APPLICATION" ID ⚠️
        const CLIENT_ID = "1078904057208-m653sh6blj9ae4icq54l3cgljljkm61u.apps.googleusercontent.com";

        function handleCredentialResponse(response) {
            STATUS.innerText = "Verifying...";
            
            // 3. EXTENSION ID CHECK
            if (!EXT_ID) {
                STATUS.innerText = "Error: No Extension ID found. Please open from the extension.";
                STATUS.style.color = "red";
                return;
            }

            // 4. SEND TOKEN TO EXTENSION
            try {
                // We use the ID Token directly for verification
                chrome.runtime.sendMessage(EXT_ID, { 
                    type: "WEB_LOGIN_SUCCESS", 
                    token: response.credential 
                }, (resp) => {
                    if (chrome.runtime.lastError) {
                        STATUS.innerText = "Error: Could not talk to extension. Is it installed?";
                        STATUS.style.color = "red";
                        console.error(chrome.runtime.lastError);
                    } else {
                        STATUS.innerText = "Success! Closing window...";
                        STATUS.style.color = "#22c55e";
                        setTimeout(() => window.close(), 1500);
                    }
                });
            } catch (e) {
                STATUS.innerText = "Error sending message: " + e.message;
                STATUS.style.color = "red";
            }
        }

        window.onload = function () {
            google.accounts.id.initialize({
                client_id: CLIENT_ID,
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.getElementById("buttonDiv"),
                { theme: "filled_black", size: "large", width: 250 }
            );
            // Auto prompt
            google.accounts.id.prompt(); 
        };
    </script>
</body>
</html>
