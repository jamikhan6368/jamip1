<style>
    /* Add this to your CSS */
    .pending { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .btn-approve { background: #22c55e; color: #0f172a; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-right: 5px; }
    .btn-approve:hover { filter: brightness(1.1); }
</style>

<script>
function renderTable(data) {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = '';
    
    let activeCount = 0;
    data.forEach(row => {
        if(row.is_active) activeCount++;
        
        const statusBadge = row.is_active 
            ? (new Date(row.expires_at) < new Date() ? '<span class="badge expired">Expired</span>' : '<span class="badge active">Active</span>')
            : '<span class="badge pending">Pending Approval</span>';

        const actionBtn = !row.is_active 
            ? `<button class="btn-approve" onclick="approveUser(${row.key_id})">âœ” Approve</button>` 
            : '';

        const trxDisplay = row.transaction_id 
            ? `<div style="font-size:10px; color:#94a3b8;">TRX: <span style="color:#fff">${row.transaction_id}</span> (${row.payment_method})</div>` 
            : '';

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>#${row.key_id}</td>
            <td>
                <div style="color:#38bdf8; font-weight:bold;">${row.email || row.license_key}</div>
                ${trxDisplay}
            </td>
            <td>${row.device_id ? 'ðŸ”’' : '-'}</td>
            <td>${statusBadge}</td>
            <td>${new Date(row.expires_at).toLocaleDateString()}</td>
            <td>
                ${actionBtn}
                <button class="btn-del" onclick="deleteUser(${row.key_id})">Delete</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
    document.getElementById('active-users').innerText = activeCount;
    document.getElementById('total-users').innerText = data.length;
}

async function approveUser(id) {
    if(!confirm("Confirm payment received? This will activate the user for 30 days.")) return;
    await fetch('/api/admin', {
        method: 'PUT',
        headers: { 'Authorization': 'Bearer ' + TOKEN, 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, action: 'approve' })
    });
    fetchData();
}
</script>
